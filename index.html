<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expertisekosten Calculator</title>
</head>
<body>

    <div>
        <h1>Expertisekosten Calculator</h1>

        <label for="verzekeringsmaatschappij">Verzekeringsmaatschappij:</label>
        <select id="verzekeringsmaatschappij">
            <option value="AG Insurance">AG Insurance</option>
            <option value="Ethias">Ethias</option>
            <!-- Voeg hier andere verzekeringsmaatschappijen toe -->
        </select>

        <label for="vergoeding">Bedrag van de vergoeding:</label>
        <input type="text" id="vergoeding" placeholder="Bedrag in Euro" oninput="this.value = this.value.replace(/[^0-9.]/g, '');">

        <button onclick="berekenExpertisekosten()">Bereken Expertisekosten</button>

        <p id="resultaat"></p>
    </div>

    <script>
        function berekenExpertisekosten() {
            var maatschappij = document.getElementById("verzekeringsmaatschappij").value;
            var vergoeding = parseFloat(document.getElementById("vergoeding").value);

            // Haal de expertisekosten op uit het CSV-bestand voor de geselecteerde maatschappij
            fetch('verzekeringsmaatschappijen.csv')
                .then(response => response.text())
                .then(data => {
                    // Verwerk de CSV-gegevens
                    var rows = data.split('\n');
                    var expertisekosten;
                    for (var i = 1; i < rows.length; i++) { // Begin bij 1 om de koptekst over te slaan
                        var columns = rows[i].split(',');
                        if (columns[0] === maatschappij) {
                            expertisekosten = berekenExpertisekostenVolgensTarieven(columns, vergoeding);
                            if (expertisekosten) {
                                document.getElementById("resultaat").innerText = "Expertisekosten bij " + maatschappij + ": " + expertisekosten.toFixed(2) + " Euro";
                            } else {
                                document.getElementById("resultaat").innerText = "Fout bij het berekenen van de expertisekosten.";
                            }
                            return;
                        }
                    }
                    document.getElementById("resultaat").innerText = "Tarieven voor deze maatschappij niet gevonden.";
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById("resultaat").innerText = "Er is een fout opgetreden bij het verwerken van het CSV-bestand.";
                });
        }

        function berekenExpertisekostenVolgensTarieven(tarieven, vergoeding) {
            try {
                // Controleer of de tarieven array de juiste lengte heeft
                if (tarieven.length !== 7) {
                    console.error('Ongeldige tarieven:', tarieven);
                    return null;
                }

                var minimum = parseFloat(tarieven[1]); // Minimum expertisekosten
                var threshold1 = parseInt(tarieven[2]);
                var rate1 = parseFloat(tarieven[3]);
                var threshold2 = parseInt(tarieven[4]);
                var rate2 = parseFloat(tarieven[5]);
                var rate3 = parseFloat(tarieven[6]);

                var expertisekosten;

                if (vergoeding <= threshold1) {
                    expertisekosten = (vergoeding * rate1);
                } else if (vergoeding <= threshold2) {
                    expertisekosten = (threshold1 * rate1 + (vergoeding - threshold1) * rate2);
                } else {
                    expertisekosten = (threshold1 * rate1 + (threshold2 - threshold1) * rate2 + (vergoeding - threshold2) * rate3);
                }

                // Toepassen van het minimum expertisekosten
                if (expertisekosten < minimum) {
                    expertisekosten = minimum;
                }

                return expertisekosten;
            } catch (error) {
                console.error('Fout bij het berekenen van expertisekosten:', error);
                return null;
            }
        }
    </script>

</body>
</html>
